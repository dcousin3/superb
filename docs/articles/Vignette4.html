<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using a custom statistic with its error bar • superb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using a custom statistic with its error bar">
<meta property="og:description" content="In superb, it is possible to summarize your data set with any descriptive statistics. The most common descriptive statistics are built-in superbPlot, but if you wish to  use a different descriptive statistics, it can easily be added to superbPlot. This vignette explains how to add a custom descriptive statistic and how to add its  precision interval to superbPlot.
">
<meta property="og:image" content="http://dcousin3.github.io/superb/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">superb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.4.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Vignette1.html">Four steps to make your plot</a>
    </li>
    <li>
      <a href="../articles/Vignette2.html">Why use difference-adjusted confidence intervals?</a>
    </li>
    <li>
      <a href="../articles/Vignette3.html">Why use correlation-adjusted confidence intervals?</a>
    </li>
    <li>
      <a href="../articles/Vignette4.html">Using a custom statistic with its error bar</a>
    </li>
    <li>
      <a href="../articles/Vignette5.html">Devising custom plot layouts</a>
    </li>
    <li>
      <a href="../articles/Vignette6.html">Generating ready-to-analyze datasets with GRD</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Vignette4_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using a custom statistic with its error bar</h1>
            
      
      
      <div class="hidden name"><code>Vignette4.Rmd</code></div>

    </div>

    
    
<p>By default, <code>superbPlot</code> generates mean plots along with 95% confidence intervals of the mean. However, these choices can be changed.</p>
<ul>
<li><p>To change the summary statistics, use the argument <code>statistic =</code>;</p></li>
<li><p>To change the confidence level, use the argument <code>gamma =</code>;</p></li>
<li><p>To change the interval function, use the argument <code>errorbar =</code>. The abbreviation <code>CI</code> stands for confidence interval; <code>SE</code> stands for standard error.</p></li>
</ul>
<p>The defaults are <code>statistic = "mean", errorbar = "CI", gamma = 0.95</code>. For error bar functions that accept a gamma parameter (e.g., <code>CI</code>, the gamma parameter is automatically transfer to the function). For other functions that do not accept a gamma parameter (e.g., <code>SE</code>), the gamma parameter is unused.</p>
<div id="changing-the-summary-function-to-be-plotted" class="section level2">
<h2 class="hasAnchor">
<a href="#changing-the-summary-function-to-be-plotted" class="anchor"></a>Changing the summary function to be plotted</h2>
<p>In what follow, we use <code><a href="../reference/GRD.html">GRD()</a></code> to generate a random dataset with an interaction then make plots varying the statistics displayed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># shut down 'warnings', 'design' and 'summary' messages</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>superb.feedback <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> 

<span class="co"># Generate a random dataset from a (3 x 2) design, entirely within subject.</span>
<span class="co"># The sample size is very small (n=5) and the correlation between scores is high (rho = .8)</span>
<span class="va">dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GRD.html">GRD</a></span><span class="op">(</span> 
    WSFactors  <span class="op">=</span> <span class="st">"Moment(3): Dose(2)"</span>, 
    Effects    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Dose*Moment"</span><span class="op">=</span><span class="fu"><a href="../reference/slope.html">custom</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>, 
    SubjectsPerGroup <span class="op">=</span> <span class="fl">50</span>, 
    Population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> mean<span class="op">=</span><span class="fl">10</span>, stddev <span class="op">=</span> <span class="fl">5</span>, rho <span class="op">=</span> <span class="fl">.80</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># a quick function to call superbPlot</span>
<span class="va">makeplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">statfct</span>, <span class="va">errorbarfct</span>, <span class="va">gam</span>, <span class="va">rg</span>, <span class="va">subttl</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">dta</span>, 
        WSFactor  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Moment(3)"</span>,<span class="st">"Dose(2)"</span><span class="op">)</span>, 
        variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DV.1.1"</span>,<span class="st">"DV.2.1"</span>,<span class="st">"DV.3.1"</span>,<span class="st">"DV.1.2"</span>,<span class="st">"DV.2.2"</span>,<span class="st">"DV.3.2"</span><span class="op">)</span>, 
        statistic <span class="op">=</span> <span class="va">statfct</span>, 
        errorbar  <span class="op">=</span> <span class="va">errorbarfct</span>, 
        gamma     <span class="op">=</span> <span class="va">gam</span>, 
        plotStyle <span class="op">=</span> <span class="st">"line"</span>,
        adjustments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>purpose<span class="op">=</span><span class="st">"difference"</span>, decorrelation<span class="op">=</span><span class="st">"CM"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="va">subttl</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span> ylim <span class="op">=</span> <span class="va">rg</span> <span class="op">)</span>
<span class="op">}</span> 

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">makeplot</span><span class="op">(</span><span class="st">"mean"</span>,      <span class="st">"CI"</span>, <span class="fl">.95</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">14</span><span class="op">)</span>, <span class="st">"Mean +- 95% CI of the mean"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">makeplot</span><span class="op">(</span><span class="st">"mean"</span>,      <span class="st">"SE"</span>, <span class="fl">.00</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">14</span><span class="op">)</span>, <span class="st">"Mean +- SE of the mean"</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">makeplot</span><span class="op">(</span><span class="st">"median"</span>,    <span class="st">"CI"</span>, <span class="fl">.95</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">14</span><span class="op">)</span>, <span class="st">"Median +- 95% CI of the median"</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">makeplot</span><span class="op">(</span><span class="st">"fisherskew"</span>,<span class="st">"CI"</span>, <span class="fl">.95</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="op">+</span><span class="fl">2</span><span class="op">)</span>, <span class="st">"Fisher skew +- 95% CI"</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>,<span class="va">p2</span>,<span class="va">p3</span>,<span class="va">p4</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="Vignette4_files/figure-html/unnamed-chunk-2-1.png" alt="Figure 1: Various statistics and various measures of precisions" width="700"><p class="caption">
Figure 1: Various statistics and various measures of precisions
</p>
</div>
</div>
<div id="determining-that-a-summary-function-is-valid-to-use-in-superbplot" class="section level2">
<h2 class="hasAnchor">
<a href="#determining-that-a-summary-function-is-valid-to-use-in-superbplot" class="anchor"></a>Determining that a summary function is valid to use in superbPlot</h2>
<p>Any summary function can be accepted by superbPlot, as long as it is given within double-quote. The built-in statistics functions such as <code>mean</code> and <code>median</code> can be given. Actually, any descriptive statistics, not just central tendency, can be provided. That includes <code>IQR</code>, <code>mad</code>, etc. To be valid, the function must return a number when given a vector of numbers.</p>
<p>In doubt, you can test if the function is valid for <code>superbPlot</code> with (note the triple colon):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">superb</span><span class="fu">:::</span><span class="fu">is.stat.function</span><span class="op">(</span><span class="st">"mean"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Any error bar function can be accepted by superbPlot. These functions must be named “interval function.”“descriptive statistic.” For example, the following <code>CI.mean</code> is the confidence interval of the mean. Other functions are <code>SE.mean</code>, <code>SE.median</code>, <code>CI.fisherskew</code>, etc. The <code>superb</code> library provides some 20+ such functions. <span class="citation">Harding, Tremblay, &amp; Cousineau (2014)</span> and <span class="citation">Harding, Tremblay, &amp; Cousineau (2015)</span> review some of these functions.</p>
<p>The error bar functions can be of three types:</p>
<ul>
<li><p>a function that returns a width. Standard error functions are example of this type of function. With width function, the error bar extend plus and minus that width around the descriptive statistics.</p></li>
<li><p>an interval function. Such functions returns the actual lower and upper limits of the interval and therefore are used as is to draw the bar (i.e., they are not relative to the descriptive statistics). Confidence interval functions are of this type (as they are not necessarily symmetrical about the descriptive statistics).</p></li>
<li><p><code>"none"</code>. This keyword produces an error bar of null width.</p></li>
</ul>
<p>The interval function can be tested to see if it exists:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">superb</span><span class="fu">:::</span><span class="fu">is.errorbar.function</span><span class="op">(</span><span class="st">"SE.mean"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>To see if a gamma is accepted for a certain interval function, you can try</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">superb</span><span class="fu">:::</span><span class="fu">is.gamma.required</span><span class="op">(</span><span class="st">"SE.mean"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="creating-a-custom-made-descriptive-statistic-function-to-be-used-in-superbplot" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-custom-made-descriptive-statistic-function-to-be-used-in-superbplot" class="anchor"></a>Creating a custom-made descriptive statistic function to be used in superbPlot</h2>
<p>As an example, we create from scratch a descriptive statistic function that will be fed to <code>superbPlot</code>. Following <span class="citation">Goulet-Pelletier &amp; Cousineau (2018)</span> , we implement the single-group design Cohen’s d (<span class="math inline">\(d_1\)</span>). This descriptive statistic is computed relative to an hypothetical population mean. Herein, we use the data from <code>dataFigure1</code> and assume that the population mean is 100.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="co"># create a descriptive statistics</span>
    <span class="va">d1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">X</span><span class="op">-</span><span class="fl">100</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> 
    <span class="op">}</span> 

    <span class="co"># we can test it with the data from group 1...</span>
    <span class="va">grp1</span> <span class="op">&lt;-</span> <span class="va">dataFigure1</span><span class="op">$</span><span class="va">score</span><span class="op">[</span><span class="va">dataFigure1</span><span class="op">$</span><span class="va">grp</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>
    <span class="va">grp2</span> <span class="op">&lt;-</span> <span class="va">dataFigure1</span><span class="op">$</span><span class="va">score</span><span class="op">[</span><span class="va">dataFigure1</span><span class="op">$</span><span class="va">grp</span><span class="op">==</span><span class="fl">2</span><span class="op">]</span>
    <span class="fu">d1</span><span class="op">(</span><span class="va">grp1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.5004172</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="co"># or check that it is a valid statistic function</span>
    <span class="fu">superb</span><span class="fu">:::</span><span class="fu">is.stat.function</span><span class="op">(</span><span class="st">"d1"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Once we have the function, we can ask for a plot of this function with</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">dataFigure1</span>, 
        BSFactor <span class="op">=</span> <span class="st">"grp"</span>, 
        statistic <span class="op">=</span> <span class="st">"d1"</span>, errorbar <span class="op">=</span> <span class="st">"none"</span>,
        plotStyle<span class="op">=</span><span class="st">"line"</span>,
        adjustments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>purpose <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span>,
        variable <span class="op">=</span> <span class="st">"score"</span>,
        errorbarParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="co"># so that the null-width error bar is invisible</span>
    <span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Cohen's d_1"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"d_1 with no error bars"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span> ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="op">+</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">)</span> </code></pre></div>
<div class="figure">
<img src="Vignette4_files/figure-html/unnamed-chunk-7-1.png" alt="Figure 2: ``superbPlot`` with a custom-made descriptive statistic function " width="700"><p class="caption">
Figure 2: <code>superbPlot</code> with a custom-made descriptive statistic function
</p>
</div>
</div>
<div id="creating-a-custom-made-interval-function-to-be-used-in-superbplot" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-custom-made-interval-function-to-be-used-in-superbplot" class="anchor"></a>Creating a custom-made interval function to be used in <code>superbPlot</code>
</h2>
<p>It is also possible to create custom-made confidence interval functions.</p>
<p>Hereafter, we add a confidence interval for the Cohen’s <span class="math inline">\(d_1\)</span>. We use the predictive approach documented in Lecoutre <span class="citation">(Cousineau &amp; Goulet-Pelletier, 2020; Lecoutre, 1999)</span> which requires the lambda-prime distribution <span class="citation">(Pav, 2020)</span>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/shabbychef/sadists">sadists</a></span><span class="op">)</span>

    <span class="va">CI.d1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">gamma</span> <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">n</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
        <span class="va">dlow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sadists/man/dlambdap.html">qlambdap</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">-</span><span class="va">gamma</span><span class="op">/</span><span class="fl">2</span>, df <span class="op">=</span> <span class="va">n</span><span class="op">-</span><span class="fl">1</span>, t <span class="op">=</span> <span class="fu">d1</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">)</span> 
        <span class="va">dhig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sadists/man/dlambdap.html">qlambdap</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">+</span><span class="va">gamma</span><span class="op">/</span><span class="fl">2</span>, df <span class="op">=</span> <span class="va">n</span><span class="op">-</span><span class="fl">1</span>, t <span class="op">=</span> <span class="fu">d1</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">)</span> 
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dlow</span>, <span class="va">dhig</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
    <span class="op">}</span>

    <span class="co"># we test as an example the data from group 1</span>
    <span class="fu">CI.d1</span><span class="op">(</span><span class="va">grp1</span><span class="op">)</span>  </code></pre></div>
<pre><code>## [1] 0.07929312 0.91232550</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="co"># or check that it is a valid interval function</span>
    <span class="fu">superb</span><span class="fu">:::</span><span class="fu">is.interval.function</span><span class="op">(</span><span class="st">"CI.d1"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We have all we need to make a plot with error bars!</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">dataFigure1</span>, 
        BSFactor <span class="op">=</span> <span class="st">"grp"</span>, 
        statistic <span class="op">=</span> <span class="st">"d1"</span>, errorbar <span class="op">=</span> <span class="st">"CI"</span>,
        plotStyle<span class="op">=</span><span class="st">"line"</span>,
        adjustments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>purpose <span class="op">=</span> <span class="st">"single"</span><span class="op">)</span>,
        variable <span class="op">=</span> <span class="st">"score"</span>
    <span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Cohen's d_1"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"d_1 with 95% confidence interval of d_1"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span> ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="op">+</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">)</span> </code></pre></div>
<div class="figure">
<img src="Vignette4_files/figure-html/unnamed-chunk-9-1.png" alt="Figure 3: superbPlot with a custom-made descriptive sttistic function " width="700"><p class="caption">
Figure 3: superbPlot with a custom-made descriptive sttistic function
</p>
</div>
<p>Note that this difference-adjusted confidence interval is fully compatible with the Cohen’s dp (between the two groups) as it is 0.498 with a 95% confidence interval of [-0.068, +1.059] <span class="citation">Cousineau &amp; Goulet-Pelletier (2020)</span>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="co"># compute the Cohen's dp</span>
    <span class="va">dp</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">grp1</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">grp2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">grp1</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">grp2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>
    <span class="va">dp</span></code></pre></div>
<pre><code>## [1] 0.4981355</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="co"># get the confidence interval of this </span>
    <span class="va">lecoutre2007</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dp</span>, <span class="va">n</span>, <span class="va">gamma</span> <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">dlow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sadists/man/dlambdap.html">qlambdap</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">-</span><span class="va">gamma</span><span class="op">/</span><span class="fl">2</span>, df <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, t <span class="op">=</span> <span class="va">dp</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span> 
        <span class="va">dhig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sadists/man/dlambdap.html">qlambdap</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">+</span><span class="va">gamma</span><span class="op">/</span><span class="fl">2</span>, df <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, t <span class="op">=</span> <span class="va">dp</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span> 
        <span class="va">limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dlow</span>, <span class="va">dhig</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>
        <span class="va">limits</span>
    <span class="op">}</span>
    <span class="fu">lecoutre2007</span><span class="op">(</span><span class="va">dp</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">grp1</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<pre><code>## [1] -0.06757432  1.05882487</code></pre>
</div>
<div id="creating-bootstrap-based-confidence-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-bootstrap-based-confidence-intervals" class="anchor"></a>Creating bootstrap-based confidence intervals</h2>
<p>It is also possible to create bootstrap estimates of confidence intervals and integrate these into <code>superb</code>.</p>
<p>The general idea is to subsample with replacement the sample and compute on this subsample the descriptive statistics. This process is repeated a large number of times (here, 10,000) and the quantiles containing, say, 95% of the results is a 95% confidence interval.</p>
<p>Here, we illustrate this process with the mean. The function must be name “<em>interval function</em>.mean,” so we choose to call it <code>bootstrapCI.mean</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="co"># we define a bootstrapCI which subsample the whole sample, here called X</span>
    <span class="va">bootstrapCI.mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">gamma</span> <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10000</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">res</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">X</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
      <span class="op">}</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span> <span class="op">-</span> <span class="va">gamma</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="va">gamma</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>

    <span class="co"># we check that it is a valid interval function</span>
    <span class="fu">superb</span><span class="fu">:::</span><span class="fu">is.interval.function</span><span class="op">(</span><span class="st">"bootstrapCI.mean"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>This is all we need to make the plot which we can compare with the formula CI</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">dataFigure1</span>, 
        BSFactor <span class="op">=</span> <span class="st">"grp"</span>, 
        variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"score"</span><span class="op">)</span>, 
        plotStyle<span class="op">=</span><span class="st">"line"</span>,
        statistic <span class="op">=</span> <span class="st">"mean"</span>, errorbar <span class="op">=</span> <span class="st">"bootstrapCI"</span>,
        adjustments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>purpose <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Score"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"means and difference-adjusted\n95% confidence intervals"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span> ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">85</span>,<span class="fl">115</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1"</span> <span class="op">=</span> <span class="st">"Collaborative games"</span>, <span class="st">"2"</span> <span class="op">=</span> <span class="st">"Unstructured activity"</span><span class="op">)</span><span class="op">)</span>

    <span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">dataFigure1</span>, 
        BSFactor <span class="op">=</span> <span class="st">"grp"</span>, 
        variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"score"</span><span class="op">)</span>, 
        plotStyle<span class="op">=</span><span class="st">"line"</span>,
        statistic <span class="op">=</span> <span class="st">"mean"</span>, errorbar <span class="op">=</span> <span class="st">"CI"</span>,
        adjustments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>purpose <span class="op">=</span> <span class="st">"difference"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Score"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"means and difference-adjusted\n95% bootstrap confidence intervals"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span> ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">85</span>,<span class="fl">115</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1"</span> <span class="op">=</span> <span class="st">"Collaborative games"</span>, <span class="st">"2"</span> <span class="op">=</span> <span class="st">"Unstructured activity"</span><span class="op">)</span><span class="op">)</span>

    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
    <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">plt1</span>, <span class="va">plt2</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="Vignette4_files/figure-html/unnamed-chunk-12-1.png" alt="Figure 4: superbPlot with a custom-made interval function." width="700"><p class="caption">
Figure 4: superbPlot with a custom-made interval function.
</p>
</div>
<p>As seen, there is not much difference between the two. This was expected: when the normality assumption and the homogeneity of variances assumption are not invalid, the <em>parametric</em> approach (the formula is based on these assumptions) is identical on average to the bootstrap approach.</p>
</div>
<div id="in-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#in-summary" class="anchor"></a>In summary</h2>
<p>The function <code>superbPlot</code> is entirely customizable: you can put any descriptive statistic function and any interval function into <code>superbPlot</code>. In a sense, <code>superbPlot</code> is simply a proxy that manage the dataset and produces standardized dataframes apt to be transmitted to a ggplot specification. It is also possible to obtain the summary dataframe by issuing the option <code>showPlot=FALSE</code></p>
<p>The function <code>superbPlot</code> is also customizable with regards to the plot produced. Included in the package are * <code>superbPlot.line</code> : shows the results as points and lines, * <code>superbPlot.point</code>: shows the results as points only, * <code>superbPlot.bar</code> : shows the results using bars, * <code>superbPlot.pointjitter</code>: shows the results with points, and the raw data with jittered points, * <code>superbPlot.pointjitterviolin</code>: also shows violin plot behind the jitter points, and * <code>superbPlot.pointindividualline</code>: show the results with fat points, and individual results with thin lines,</p>
<p>Vignette 5 shows how to create new plotting functions. Proposals are welcome.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-cg20" class="csl-entry">
Cousineau, D., &amp; Goulet-Pelletier, J.-C. (2020). <em>A review of five techniques to derive confidence intervals with a special attention to the cohen’s dp in the between-group design</em>. PsyArXiv. <a href="https://doi.org/10.31234/osf.io/s2597">https://doi.org/10.31234/osf.io/s2597</a>
</div>
<div id="ref-gc18" class="csl-entry">
Goulet-Pelletier, J.-C., &amp; Cousineau, D. (2018). A review of effect sizes and their confidence intervals, part i: The cohen’s d family. <em>The Quantitative Methods for Psychology</em>, <em>14</em>(4), 242–265. <a href="https://doi.org/10.20982/tqmp.14.4.p242">https://doi.org/10.20982/tqmp.14.4.p242</a>
</div>
<div id="ref-htc14" class="csl-entry">
Harding, B., Tremblay, C., &amp; Cousineau, D. (2014). Standard errors: A review and evaluation of standard error estimators using monte carlo simulations. <em>The Quantitative Methods for Psychology</em>, <em>10</em>(2), 107–123.
</div>
<div id="ref-htc15" class="csl-entry">
Harding, B., Tremblay, C., &amp; Cousineau, D. (2015). The standard error of the pearson skew. <em>The Quantitative Methods for Psychology</em>, <em>11</em>(1), 32–36.
</div>
<div id="ref-l99" class="csl-entry">
Lecoutre, B. (1999). Two useful distributions for bayesian predictive procedures under normal models. <em>Journal of Statistical Planning and Inference</em>, <em>79</em>(1), 93–105.
</div>
<div id="ref-p20" class="csl-entry">
Pav, S. E. (2020). <em><span class="nocase">sadists</span>: Some additional distributions [r package]</em>. Retrieved from <a href="https://github.com/shabbychef/sadists">https://github.com/shabbychef/sadists</a>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Denis Cousineau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
