<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>(advanced) Local decorrelation for time series • superb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="(advanced) Local decorrelation for time series">
<meta property="og:description" content="This vignette provides an overview of the local decorrelation technique  from time series with vanishing amount of correlations.
">
<meta property="og:image" content="http://dcousin3.github.io/superb/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">superb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.95.14</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Vignette1.html">Three steps to make your plot</a>
    </li>
    <li>
      <a href="../articles/Vignette2.html">Why use difference-adjusted confidence intervals?</a>
    </li>
    <li>
      <a href="../articles/Vignette3.html">Why use correlation-adjusted confidence intervals?</a>
    </li>
    <li>
      <a href="../articles/Vignette9.html">Plotting Cohen's d with ``superb``</a>
    </li>
    <li>
      <a href="../articles/VignetteC.html">Plotting proportions with ``superb``</a>
    </li>
    <li>
      <a href="../articles/VignetteF.html">Plotting frequencies using ``superb``</a>
    </li>
    <li>
      <a href="../articles/VignetteA.html">Plotting Reference Intervals with ``superb``</a>
    </li>
    <li>
      <a href="../articles/TheMakingOf.html">The making-of the figures in the article</a>
    </li>
    <li>
      <a href="../articles/CustomizingSuperbPlots.html">Customizing `superb` plots</a>
    </li>
    <li>
      <a href="../articles/VignetteE.html">Adding labels to ``superb`` plots</a>
    </li>
    <li>
      <a href="../articles/Vignette7.html">Unequal variances, Welch test, Tryon adjustment, and ``superb``</a>
    </li>
    <li>
      <a href="../articles/Vignette8.html">(advanced) Alternate ways to decorrelate repeated measures from transformations</a>
    </li>
    <li>
      <a href="../articles/VignetteG.html">(advanced) Local decorrelation for time series</a>
    </li>
    <li>
      <a href="../articles/VignetteB.html">(advanced) Non-factorial within-subject designs in ``superb``</a>
    </li>
    <li>
      <a href="../articles/Vignette4.html">Using a custom statistic with its error bar within ``superb``</a>
    </li>
    <li>
      <a href="../articles/Vignette5.html">Using a custom plot layout within ``superb``</a>
    </li>
    <li>
      <a href="../articles/VignetteD.html">``superb`` and SPSS</a>
    </li>
    <li>
      <a href="../articles/Vignette6.html">Generating ready-to-analyze datasets with GRD</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dcousin3/superb/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>(advanced) Local decorrelation for time
series</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dcousin3/superb/blob/HEAD/../vignettes/VignetteG.Rmd" class="external-link"><code>../vignettes/VignetteG.Rmd</code></a></small>
      <div class="hidden name"><code>VignetteG.Rmd</code></div>

    </div>

    
    
<p>The decorrelation of the measures in repeated-measure designs is
meant to have error bars that are integrating the added power of using
repeated-measures over independent groups. In design with a few
measurements, the correlation between the pairs of measurements is
indicative of the gain in statistical power. However, in time series,
correlation is likely to vanish as measurements get further spaced in
time (the <code>lag</code> effect).</p>
<p>For example, consider a longitudinal study of adolescents over 10
years. The measurements that are 6-month apart may show some
correlations, but the two most separated measurements (say the first at
8 years old and the second at 18 years old) are much less likely to
preserve their correlations.</p>
<p>This vignette propose a solution. It is detailed in <span class="citation">Cousineau, Proulx, Potvin-Pilon, &amp; Fiset (in
preparation)</span>.</p>
<div class="section level3">
<h3 id="the-structure-of-correlations">The structure of correlations<a class="anchor" aria-label="anchor" href="#the-structure-of-correlations"></a>
</h3>
<p>When repeated measures are obtained, one may compute the correlation
matrix. The correlation matrix is always composed of 1s along the main
diagonal, as the correlation of a variable with itself is always 1. What
is more interesting is what happen off the main diagonal.</p>
<p>In some situations, the correlations are fairly constant
(stationary). When the variance are further homogeneous, this
correlation structure is known as <code>compound symmetry</code>.
Compound symmetry is the simplest situation and also the easiest to
analyze (with e.g., ANOVAs, alghough ANOVA really requires
<code>sphericity</code>, a slightly different correlation
structure).</p>
<p>In other situations, we might see that correlations near the main
diagnonal are strong, but as we distance from the diagonal (either in
the upper-right or lower-left directions), the correlations slowly
vanishes, possibly reaching near-null values. This structure is known as
an <code>autoregressive covariance structure of the first order</code>
or AR(1). In time series, that would indicate that the correlation of a
measurement with the measurement just before or just after is high, but
that the correlation between a measurement and a distant measurement is
weak.</p>
</div>
<div class="section level3">
<h3 id="implications-for-precision">Implications for precision<a class="anchor" aria-label="anchor" href="#implications-for-precision"></a>
</h3>
<p>Vanishing correlations means that comparing distant points in time
will be performed with weaker statistical precision and comparisons of
close-by measures will benefit from much correlation (<em>correlation is
your friend</em> when it comes to statistical inference).</p>
<p>In plotting curves, our objective may be to see how the points
evolves, which imply that we are making multiple comparisons of close-by
points. If so, our visual tools should be based on the correlation
(presumably high) between these nearby points. If our objective is
instead to compare far-distance points, the visual tools should
incorporate the correlations of these distant points (presumably
weak).</p>
</div>
<div class="section level3">
<h3 id="how-is-correlation-assessed-then">How is correlation assessed then?<a class="anchor" aria-label="anchor" href="#how-is-correlation-assessed-then"></a>
</h3>
<p>There are a few techniques to estimate the correlation in a
correlation matrix. When it is assumed compound symmetric, the average
of the pairwise correlations is satisfactory. When it is AR(1) however,
the average won’t do as the correlation is varying based on the lag.</p>
<p>We argue that a fit technique is to average the correlations using
weights that are reducing with distance (excluding the main diagonal
whose weight is set to 0). Any kernel (for example a gaussian kernel)
can be used to that end, as long as the width is kept smaller than the
number of variables. We implemtented this technique in
<code>superb</code>.</p>
</div>
<div class="section level3">
<h3 id="illustration-with-fmri-data">Illustration with fMRI data<a class="anchor" aria-label="anchor" href="#illustration-with-fmri-data"></a>
</h3>
<p><span class="citation">Waskom, Frank, &amp; Wagner (2017)</span>
examined the finite impulse response obtained from an fMRI for two sites
(frontal and parietal) and two event conditions (a cue-only condition
and a cue+stimulus condition). The responses are obtained over 19 time
points (labeled 0 to 18) in these four conditions, resulting in 76
measurements. There are 14 participants.</p>
<p>We first fetch the data from the main author’s GitHub repository:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fmri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/mwaskom/seaborn-data/de49440879bea4d563ccefe671fd7584cba08983/fmri.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As the data are in no specific order, we first sort them by subject,
type of event, and region as well as by time points and next, we convert
the data into a wide data frame of dimensions 14 lines per 77
columns:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sort the data...</span></span>
<span><span class="va">fmri</span> <span class="op">&lt;-</span> <span class="va">fmri</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">fmri</span><span class="op">$</span><span class="va">subject</span>, <span class="va">fmri</span><span class="op">$</span><span class="va">event</span>, <span class="va">fmri</span><span class="op">$</span><span class="va">region</span>, <span class="va">fmri</span><span class="op">$</span><span class="va">timepoint</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#... then convert to wide</span></span>
<span><span class="va">fmriWide</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbToWide.html">superbToWide</a></span><span class="op">(</span><span class="va">fmri</span>, id<span class="op">=</span><span class="st">"subject"</span>, </span>
<span>    WSFactors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"event"</span>,<span class="st">"region"</span>,<span class="st">"timepoint"</span><span class="op">)</span>, </span>
<span>    variable <span class="op">=</span> <span class="st">"signal"</span><span class="op">)</span></span></code></pre></div>
<p>We are ready to make plots!</p>
<div class="section level4">
<h4 id="a-plot-without-decorrelation">A plot without decorrelation<a class="anchor" aria-label="anchor" href="#a-plot-without-decorrelation"></a>
</h4>
<p>The first plot is done without adjustments. By default, it shows the
standalone 95% confidence interval.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span> <span class="va">fmriWide</span>,</span>
<span>  WSFactors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"timepoint(19)"</span>,<span class="st">"region(2)"</span>,<span class="st">"event(2)"</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fmriWide</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">77</span><span class="op">]</span>,</span>
<span>  plotStyle <span class="op">=</span> <span class="st">"lineBand"</span>,</span>
<span>  pointParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,</span>
<span>  lineParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"purple"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Time"</span>, labels <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_discrete_manual</a></span><span class="op">(</span>aesthetic <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>,<span class="st">"colour"</span><span class="op">)</span>, </span>
<span>                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"frontal"</span>,<span class="st">"parietal"</span><span class="op">)</span>, </span>
<span>                      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"green"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<div class="figure">
<img src="VignetteG_files/figure-html/unnamed-chunk-4-1.png" alt="**Figure 1**. Plot of the fMRI data with standalone confidence intervals." width="672"><p class="caption">
<strong>Figure 1</strong>. Plot of the fMRI data with standalone
confidence intervals.
</p>
</div>
<p>The <code>scale_x_discrete</code> is done to rename the ticks from 0
to 18 (they would start at 1 otherwise). The
<code>scale_discrete_manual</code> changes the color of the band (I hope
you are color-blind, colors is not my thing). The
<code>plotStyle = "lineBand"</code> displays the confidence intervals as
a band rather than as error bars.</p>
</div>
<div class="section level4">
<h4 id="plots-with-decorrelation">Plots with decorrelation<a class="anchor" aria-label="anchor" href="#plots-with-decorrelation"></a>
</h4>
<p>The decorrelation technique was first proposed by <span class="citation">Loftus &amp; Masson (1994)</span>. Alternatives
approaches were developped in <span class="citation">Cousineau
(2005)</span> with <span class="citation">Morey (2008; also see
Cousineau, 2019)</span>. They are known in <code><a href="../reference/superbPlot.html">superbPlot()</a></code> as
<code>"LM"</code> and <code>"CM"</code> respectively.</p>
<p>If you add this adjustment with this command, you get the following
plot:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span> <span class="va">fmriWide</span>,</span>
<span>  WSFactors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"timepoint(19)"</span>,<span class="st">"region(2)"</span>,<span class="st">"event(2)"</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fmriWide</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">77</span><span class="op">]</span>,</span>
<span>  adjustments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>decorrelation <span class="op">=</span> <span class="st">"CM"</span><span class="op">)</span>, <span class="co">## only new line</span></span>
<span>  plotStyle <span class="op">=</span> <span class="st">"lineBand"</span>,</span>
<span>  pointParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,</span>
<span>  lineParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"purple"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Time"</span>, labels <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_discrete_manual</a></span><span class="op">(</span>aesthetic <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>,<span class="st">"colour"</span><span class="op">)</span>, </span>
<span>                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"frontal"</span>,<span class="st">"parietal"</span><span class="op">)</span>, </span>
<span>                      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"green"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="../reference/showSignificance.html">showSignificance</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.02</span>, <span class="st">"n.s.?"</span>, panel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>event<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## superb::FYI: The HyunhFeldtEpsilon measure of sphericity per group are  0.052</span></span></code></pre>
<pre><code><span><span class="co">## superb::FYI: All the groups' data are compound symmetric. Consider using CA or UA.</span></span></code></pre>
<div class="figure">
<img src="VignetteG_files/figure-html/unnamed-chunk-5-1.png" alt="**Figure 2**. Plot of the fMRI data with Cousineau-Morey decorrelation." width="672"><p class="caption">
<strong>Figure 2</strong>. Plot of the fMRI data with Cousineau-Morey
decorrelation.
</p>
</div>
<p>As you may see, this plot and the previous one are nearly identical!
This is because the average correlation involving close-by and
far-distant points is very weak (close to zero; replace CM with CA and a
message will return the average correlation in addition to a plot).</p>
<p>Because fMRI points are separated by time, close-by points ought to
show some correlation. This is where local decorrelation may be
useful.</p>
<p>We repeat the above command, but this time ask for a local average of
the correlation. We need to specify the radius of the kernel, which we
do by adding an integer after the letters “LD”. Here, we show the
results with a narrow kernel, weighting far more adjacent points than
points 3 time points appart, obtained with <code>"LD2"</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span> <span class="va">fmriWide</span>,</span>
<span>  WSFactors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"timepoint(19)"</span>,<span class="st">"region(2)"</span>,<span class="st">"event(2)"</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fmriWide</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">77</span><span class="op">]</span>,</span>
<span>  adjustments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>decorrelation <span class="op">=</span> <span class="st">"LD2"</span><span class="op">)</span>,  <span class="co">## CM replaced with LD2</span></span>
<span>  plotStyle <span class="op">=</span> <span class="st">"lineBand"</span>,</span>
<span>  pointParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,</span>
<span>  lineParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"purple"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Time"</span>, labels <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_discrete_manual</a></span><span class="op">(</span>aesthetic <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>,<span class="st">"colour"</span><span class="op">)</span>, </span>
<span>                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"frontal"</span>,<span class="st">"parietal"</span><span class="op">)</span>, </span>
<span>                      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"green"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="../reference/showSignificance.html">showSignificance</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.02</span>, <span class="st">"**!"</span>, panel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>event<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## superb::FYI: The average correlation per group is  0.5158</span></span></code></pre>
<div class="figure">
<img src="VignetteG_files/figure-html/unnamed-chunk-6-1.png" alt="**Figure 3**. Plot of the fMRI data with local decorrelation." width="672"><p class="caption">
<strong>Figure 3</strong>. Plot of the fMRI data with local
decorrelation.
</p>
</div>
<p>As seen from the message, the correlations in nearby time points is
about .50. It explains why the precision of the measures shrank so much
(seen with confidence intervals that are much narrower). You can pick
any two nearby points and run a paired t-test, the chances are high that
you get a significant result.</p>
<p>As an example, consider the green curve, in condition cue+stimuli
(i.e., bottom panel), for time points 6 and 7. The confidence band
suggest that these two points differ when you examine the
locally-decorrelated confidence intervals, but not when you examine the
previous two plots. Which is true? Let’s run a t-test on paired
sample.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">fmriWide</span><span class="op">$</span><span class="va">`signal_stim_parietal_ 6`</span>, <span class="va">fmriWide</span><span class="op">$</span><span class="va">`signal_stim_parietal_ 7`</span>, paired<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Paired t-test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  fmriWide$`signal_stim_parietal_ 6` and fmriWide$`signal_stim_parietal_ 7`</span></span>
<span><span class="co">## t = 3.8818, df = 13, p-value = 0.00189</span></span>
<span><span class="co">## alternative hypothesis: true mean difference is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  0.02729823 0.09581713</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## mean difference </span></span>
<span><span class="co">##      0.06155768</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="the-radius-parameter">The radius parameter<a class="anchor" aria-label="anchor" href="#the-radius-parameter"></a>
</h3>
<p>You can vary the radius from 1 and above. The larger the radius, the
smallest will be the benefit of correlation in the assessment of
precision. In the extreme, if you use a very large radius (e.g.,
“LD10000”), you will get the exact same average correlation as with “CA”
as now all the correlations are weighted almost identically.</p>
<p>Note that in the above computations, I reduced the number of messages
displayed by <code>superb</code> using
<code>options("superb.feedback" = "warnings" )</code>.</p>
</div>
<div class="section level3">
<h3 id="difference-adjustments">Difference adjustments<a class="anchor" aria-label="anchor" href="#difference-adjustments"></a>
</h3>
<p>In all three figures, we did not use the difference adjustment.
Recall that this adjustment is needed when the objective of the error
bars (or error bands) is to perform comparisons between pairs of
conditions.</p>
<p>In the present example, the reader is very likely to perform
comparisons between curves so that the difference adjustment is very
much needed. Simply add <code>purpose = "difference"</code> in the
<code>adjustments</code> list of the three examples above. You will see
that of the three plots above, only the locally-decorrelated one
suggests significant differences between the bottom curves on some time
points, which is indeed what format tests indicate.</p>
</div>
<div class="section level3">
<h3 id="in-summary">In summary<a class="anchor" aria-label="anchor" href="#in-summary"></a>
</h3>
<p>Local decorrelation is a tool adapted to time series where nearby
measurements are expected to show greater correlations than measurements
separated by large amount of time. This is applicable among other to
time series, longitudinal studies, fMRI studies (as the example above)
and EEG studies (as the application described in <span class="citation">Cousineau et al. (in preparation)</span>).</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-c05" class="csl-entry">
Cousineau, D. (2005). Confidence intervals in within-subject designs: A
simpler solution to <span>L</span>oftus and <span>M</span>asson’s
method. <em>Tutorials in Quantitative Methods for Psychology</em>,
<em>1</em>, 42–45. <a href="https://doi.org/10.20982/tqmp.01.1.p042" class="external-link">https://doi.org/10.20982/tqmp.01.1.p042</a>
</div>
<div id="ref-c19" class="csl-entry">
Cousineau, D. (2019). Correlation-adjusted standard errors and
confidence intervals for within-subject designs: A simple multiplicative
approach. <em>The Quantitative Methods for Psychology</em>, <em>15</em>,
226–241. <a href="https://doi.org/10.20982/tqmp.15.3.p226" class="external-link">https://doi.org/10.20982/tqmp.15.3.p226</a>
</div>
<div id="ref-cppf24" class="csl-entry">
Cousineau, D., Proulx, A., Potvin-Pilon, A., &amp; Fiset, D. (in
preparation). Local decorrelation for error bars in time series.
<em>Tbd</em>.
</div>
<div id="ref-lm94" class="csl-entry">
Loftus, G. R., &amp; Masson, M. E. J. (1994). Using confidence intervals
in within-subject designs. <em>Psychonomic Bulletin &amp; Review</em>,
<em>1</em>, 476–490. <a href="https://doi.org/10.3758/BF03210951" class="external-link">https://doi.org/10.3758/BF03210951</a>
</div>
<div id="ref-m08" class="csl-entry">
Morey, R. D. (2008). Confidence intervals from normalized data: A
correction to <span>C</span>ousineau (2005). <em>Tutorials in
Quantitative Methods for Psychology</em>, <em>4</em>, 61–64. <a href="https://doi.org/10.20982/tqmp.04.2.p061" class="external-link">https://doi.org/10.20982/tqmp.04.2.p061</a>
</div>
<div id="ref-w17" class="csl-entry">
Waskom, M. L., Frank, M. C., &amp; Wagner, A. D. (2017). Adaptive
engagement of cognitive control in context-dependent decision making.
<em>Cerebral Cortex</em>, <em>27</em>, 1270–1284. <a href="https://doi.org/10.1093/cercor/bhv333" class="external-link">https://doi.org/10.1093/cercor/bhv333</a>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Denis Cousineau.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
