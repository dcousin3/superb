<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Illustrating Reference Intervals with ``superb`` • superb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Illustrating Reference Intervals with ``superb``">
<meta property="og:description" content="This vignette shows how to illustrate reference intervals using superb.
">
<meta property="og:image" content="http://dcousin3.github.io/superb/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">superb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.7.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TheMakingOf.html">The making-of the figures in the article</a>
    </li>
    <li>
      <a href="../articles/Vignette1.html">Four steps to make your plot</a>
    </li>
    <li>
      <a href="../articles/Vignette2.html">Why use difference-adjusted confidence intervals?</a>
    </li>
    <li>
      <a href="../articles/Vignette3.html">Why use correlation-adjusted confidence intervals?</a>
    </li>
    <li>
      <a href="../articles/Vignette4.html">Using a custom statistic with its error bar</a>
    </li>
    <li>
      <a href="../articles/Vignette5.html">Devising custom plot layouts</a>
    </li>
    <li>
      <a href="../articles/Vignette6.html">Generating ready-to-analyze datasets with GRD</a>
    </li>
    <li>
      <a href="../articles/Vignette7.html">Unequal variances, Welch test, Tryon adjustment, and ``superb``</a>
    </li>
    <li>
      <a href="../articles/Vignette8.html">(advanced) Alternate ways to decorrelate repeated measures from transformations</a>
    </li>
    <li>
      <a href="../articles/Vignette9.html">Illustrating Cohen's d with ``superb``</a>
    </li>
    <li>
      <a href="../articles/VignetteA.html">Illustrating Reference Intervals with ``superb``</a>
    </li>
    <li>
      <a href="../articles/VignetteB.html">Non-factorial within-subject designs in ``superb``</a>
    </li>
    <li>
      <a href="../articles/VignetteC.html">Plotting proportions with ``superb``</a>
    </li>
    <li>
      <a href="../articles/VignetteD.html">``superb`` and SPSS</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dcousin3/superb/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="VignetteA_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Illustrating Reference Intervals with <code>superb</code>
</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dcousin3/superb/blob/master/../vignettes/VignetteA.Rmd"><code>../vignettes/VignetteA.Rmd</code></a></small>
      <div class="hidden name"><code>VignetteA.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we show how to illustrate reference intervals using <code>superb</code>. We also show how the precision of this interval limits could be illustrated. See <span class="citation">NCCLS (2000)</span> for a definition of reference intervals. In what follows, we use the package <code>referenceIntervals</code> from <span class="citation">Finnegan (2020)</span>.</p>
<div id="what-is-a-reference-interval" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-a-reference-interval" class="anchor"></a>What is a reference interval?</h2>
<p>The reference interval is a description of the whole population. This is in contrast with other error bar functions who are associated with a specific statistics. For example, there exists the standard error of the mean, or the confidence interval of the median. The reference interval on the other hand, is an interval of all the individuals in the sample, and it aims at illustrating the normal range of individuals in the studied population. It is therefore much wider than say, the confidence interval of the mean because the mean is not interested with the whole sample, only with the center of the sample.</p>
<p>As an example, in a pharmacological cross-over study, five drug concentrations A through E are tested for their effect on glucose level (in mg/dL). The authors might be interested in knowing whether the glucose levels are different. In that case, a confidence interval for the five mean glucose level might be useful.</p>
<p>However, the research may also want to indentify the “normal range” of values of glucose levels with either of the concentrations. Note tha “normal range” is a misnomer creating confusions with the “normal distribution.” Instead, we stick to the expression <code>Reference interval</code> (as promoted by many, e.g., <span class="citation">NCCLS (2000)</span>).</p>
<p>This interval is meant to capture a given fraction of the population individuals. These individuals are variable, but this variability is ok (I don’t want to say <em>normal</em>). This range could be “associated with good health” for example <span class="citation">(NCCLS, 2000, p. 3)</span>.</p>
<p>Herein, we show how to illustrate <code>reference intervals</code>. To make the relation with the individuals more evident, we will also present these intervals in conjunction with alternative representations.</p>
</div>
<div id="displaying-a-reference-interval" class="section level2">
<h2 class="hasAnchor">
<a href="#displaying-a-reference-interval" class="anchor"></a>Displaying a reference interval</h2>
<p>To accomplish the basic computations, we rely on the excellent <code>referenceIntervals</code> from <span class="citation">Finnegan (2020)</span>. This package offers many more options that will not be explored herein.</p>
<p>Before we begin, let’s load the needed libraries…</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>            <span class="co"># for the graphing commands</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dcousin3.github.io/superb/">superb</a></span><span class="op">)</span>             <span class="co"># for superbPlot and GRD</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">referenceIntervals</span><span class="op">)</span> <span class="co"># for computing reference intervals</span></code></pre></div>
<p>(if some of these packages are not on your computer, first install it with for example <code>install.packages("referenceIntervals")</code> )</p>
<p>… then let’s create a ficticious data set on the fly:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glucoselevels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GRD.html">GRD</a></span><span class="op">(</span>BSFactors <span class="op">=</span> <span class="st">"concentration(A,B,C,D,E)"</span>, 
                    SubjectsPerGroup <span class="op">=</span> <span class="fl">100</span>,
                    RenameDV <span class="op">=</span> <span class="st">"gl"</span>,
                    Effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"concentration"</span> <span class="op">=</span> <span class="fu"><a href="../reference/slope.html">extent</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">)</span>,
                    Population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">100</span>, stddev <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">)</span> </code></pre></div>
<p>This dataset will generate 100 individuals randomly for each of the five concentrations (column <code>concentration</code>, with levels from A to E). The dependent variable, <em>glucose level</em>, is abbreviated to <code>gl</code>.</p>
<p>Here is a snapshot of it:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">glucoselevels</span><span class="op">)</span></code></pre></div>
<pre><code>##   id concentration        gl
## 1  1             A 107.48268
## 2  2             A  93.35686
## 3  3             A 112.16505
## 4  4             A  95.35360
## 5  5             A 113.82540
## 6  6             A  71.98219</code></pre>
<p>A simple plot could show the mean for each concentration along with the 95% confidence interval of the means, with e.g.,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, 
            errorbar  <span class="op">=</span> <span class="st">"CI"</span>,
            gamma     <span class="op">=</span> <span class="fl">0.95</span>,
            plotStyle <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="VignetteA_files/figure-html/unnamed-chunk-7-1.png" alt="**Figure 1**. Mean glucose level as a function of concentration." width="480"><p class="caption">
<strong>Figure 1</strong>. Mean glucose level as a function of concentration.
</p>
</div>
<p>As seen, glucose level means are affected by the concentration (that effect was requested in the <code><a href="../reference/GRD.html">GRD()</a></code> command above). Also note the vertical scale: it is very restricted around the means, yet, individuals are often much outside the visible part of the scale.</p>
<p>To convince yourself of that, ask for the smallest glucose level and the highest:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">glucoselevels</span><span class="op">$</span><span class="va">gl</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 23.96264</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">glucoselevels</span><span class="op">$</span><span class="va">gl</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 156.585</code></pre>
<p>Instead of asking for an error bar representing a confidence interval (CI), let’s ask for error bar representing the reference intervals (RI).</p>
<p>Reference intervals are not (at this time) shipped with <code>superb</code>. Let’s define a short-name version of this with</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RI.mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">gamma</span> <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/referenceIntervals/man/refLimit.html">refLimit</a></span><span class="op">(</span><span class="va">data</span>, refConf <span class="op">=</span> <span class="va">gamma</span><span class="op">)</span><span class="op">$</span><span class="va">Ref_Int</span>
<span class="op">}</span></code></pre></div>
<p>We actually use the function <code><a href="https://rdrr.io/pkg/referenceIntervals/man/refLimit.html">refLimit()</a></code> from the <code>referenceIntervals</code> package. There are many options in that function; please consult the documentation for that package. We only preserve the reference interval limits with <code>$Ref_Int</code> (that function outputs other information, as we will see below).</p>
<p>The one argument that we use is the confidence level of the reference interval, <code>refConf</code> (recommended is 95%, which is the default if none is specified).</p>
<p>As you may note, the <code>RI</code> function is <em>attached</em> to the mean. This is arbitrary: in <code>superb</code>, error bars must be error bars of a summary statistic. You could have used any function, that won’t change the position of the interval.</p>
<p>This is all we need to make our first reference interval plots:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, <span class="co"># mean is what RI is attached to</span>
            errorbar  <span class="op">=</span> <span class="st">"RI"</span>,   <span class="co"># RI calls the function above</span>
            gamma     <span class="op">=</span> <span class="fl">0.95</span>,   <span class="co"># select the coverage desired</span>
            plotStyle <span class="op">=</span> <span class="st">"line"</span> <span class="op">)</span></code></pre></div>
<div class="figure">
<img src="VignetteA_files/figure-html/unnamed-chunk-10-1.png" alt="**Figure 2**. Mean glucose level and 95% reference intervals as a function of concentration." width="480"><p class="caption">
<strong>Figure 2</strong>. Mean glucose level and 95% reference intervals as a function of concentration.
</p>
</div>
<p>You can see that the vertical range is much wider now than in Figure 1. It is ok, as these intervals cover most of the individuals in the samples.</p>
</div>
<div id="uncertainty-in-the-reference-interval-limits" class="section level2">
<h2 class="hasAnchor">
<a href="#uncertainty-in-the-reference-interval-limits" class="anchor"></a>Uncertainty in the reference interval limits</h2>
<p>The plot from Figure 2 shows the estimated range of individuals from a sample, and therefore has some uncertainty in the exact location of the tips. It is possible to add some indication of the width of uncertainty regarding these tips by estimating a confidence interval for each extremity.</p>
<p>The exact computation is based on the uncertainty of quantiles <span class="citation">(Harding, Tremblay, &amp; Cousineau, 2014; e.g., the 2.5% quantile for the lower limit of the population as infered from the 2.5% quantile of the sample, when 95% RI are plotted; see e.g., NCCLS, 2000)</span>.</p>
<p>In the packge <code>referenceIntervals</code>, the function <code><a href="https://rdrr.io/pkg/referenceIntervals/man/refLimit.html">refLimit()</a></code> also produces this information by default. The novelty is that the confidence level of the confidence interval for the tips of the RI may be different from the reference interval level.</p>
<p>As an example, the RI coverage interval might be a 95%, so as to include a wide proportion of the population, and the certainty on the tip positions of that RI might be low, e.g., 80%, because we fear that the sample is not the most representative.</p>
<p>To acheive this, we wrap the <code><a href="https://rdrr.io/pkg/referenceIntervals/man/refLimit.html">refLimit()</a></code> function in a shorter name function, <code>ciloRI</code> for the confidence intervals of the lower part of the RI, and <code>cihiRI</code> for the confidence intervals of the upper part of the RI. This function requires two gammas, one for the RI level, and the second for the CI level. Thus, we get:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ciloRI.mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">gamma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.90</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/referenceIntervals/man/refLimit.html">refLimit</a></span><span class="op">(</span><span class="va">data</span>, refConf <span class="op">=</span> <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, limitConf <span class="op">=</span> <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">)</span><span class="op">$</span><span class="va">Conf_Int</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>
<span class="op">}</span>
<span class="va">cihiRI.mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">gamma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.90</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/referenceIntervals/man/refLimit.html">refLimit</a></span><span class="op">(</span><span class="va">data</span>, refConf <span class="op">=</span> <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, limitConf <span class="op">=</span> <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">)</span><span class="op">$</span><span class="va">Conf_Int</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="op">}</span></code></pre></div>
<p>Again, this is all we need. We can for example use the following to see the uncertainty in the top tips of all the RI:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, errorbar <span class="op">=</span> <span class="st">"cihiRI"</span>,
            gamma     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.90</span><span class="op">)</span>,
            plotStyle <span class="op">=</span> <span class="st">"line"</span> <span class="op">)</span> </code></pre></div>
<div class="figure">
<img src="VignetteA_files/figure-html/unnamed-chunk-12-1.png" alt="**Figure 3**. Mean glucose level and 90% confidence intervals of the upper RI tips." width="480"><p class="caption">
<strong>Figure 3</strong>. Mean glucose level and 90% confidence intervals of the upper RI tips.
</p>
</div>
<p>Well, that is weird because now, we only see an error bar way up there. The RI error bar is now longer visible because <code><a href="../reference/superbPlot.html">superbPlot()</a></code> can only show one sort of error bar at a time.</p>
<p>Lets correct this. The gist of the following is to perform three plots, one showing the RI intervals (as Figure 2 above), a second showing the confidence interval of the RI top tips (as Figure 3 just above), and one last plot showing the confidence interval of the RI bottom tips. Plots 2 and 3 must be transparent so that they can be superimposed on top of plot 1.</p>
<p>To that end, we use a set of graphic directives that makes the plot transparent. It will be appplied to plots 2 and 3 (it hides the grid (if any) and set the background of the whole plot and of the panel to transparent). This operation is made with the function <code><a href="../reference/makeTransparent.html">makeTransparent()</a></code>.</p>
<p>It is also necessary that all plots have the same range, so that they align correctly when superimpose. To do so, we set the vertical range from 0 to 200. We also add a description in the title of the plot. These are all grouped in a list:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ornate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"(tick)     95% reference intervals (RI)"</span>,
                        <span class="st">"\n(red)      90% confidence intervals of upper 95% RI"</span>,
                        <span class="st">"\n(purple) 90% confidence intervals of lower 95% RI"</span>,
                        <span class="st">"\n(blue)    95% confidence intervals of the mean"</span><span class="op">)</span><span class="op">)</span>,
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span> ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">000</span>,<span class="fl">200</span><span class="op">)</span> <span class="op">)</span>,
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> <span class="co"># smaller font</span>
<span class="op">)</span></code></pre></div>
<p>Now that these are dealt with, let’s do our three plots:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, 
            errorbar  <span class="op">=</span> <span class="st">"RI"</span>,
            gamma     <span class="op">=</span> <span class="fl">0.95</span>,
            errorbarParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.0</span>, size <span class="op">=</span> <span class="fl">1.5</span>,
                                  position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">)</span>,
            plotStyle <span class="op">=</span> <span class="st">"line"</span> <span class="op">)</span> <span class="op">+</span> <span class="va">ornate</span>
<span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, 
            errorbar  <span class="op">=</span> <span class="st">"cihiRI"</span>,
            gamma     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.90</span><span class="op">)</span>,
            errorbarParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="st">"red"</span>,
                                  direction <span class="op">=</span> <span class="st">"left"</span>,
                                  position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.15</span><span class="op">)</span> <span class="op">)</span>,
            plotStyle <span class="op">=</span> <span class="st">"line"</span> <span class="op">)</span> <span class="op">+</span> <span class="va">ornate</span> <span class="op">+</span> <span class="fu"><a href="../reference/makeTransparent.html">makeTransparent</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">plt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, 
            errorbar  <span class="op">=</span> <span class="st">"ciloRI"</span>,
            gamma     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.90</span><span class="op">)</span>,
            errorbarParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="st">"purple"</span>,
                                  direction <span class="op">=</span> <span class="st">"left"</span>,
                                  position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.15</span><span class="op">)</span> <span class="op">)</span>,
            plotStyle <span class="op">=</span> <span class="st">"line"</span> <span class="op">)</span> <span class="op">+</span> <span class="va">ornate</span> <span class="op">+</span> <span class="fu"><a href="../reference/makeTransparent.html">makeTransparent</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Things to note: (1) only the second and third uses the transparent directives; (2) the confidence levels (<code>gamma</code>) have two numbers in plots 2 and 3: the first for the RI, the second for the CI of the RI; (3) with <code>errorbarParams</code>, we gave different attributes to the various error bars (purple color for the lower CI, for example) and moved them sligtly to the left (position).</p>
<p>Almost there. Lets turn these plots into graphic objects (<code>grob</code>), then superimpose them onto an empty plot:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># transform the three plots into visual objects</span>
<span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">plt1</span><span class="op">)</span>
<span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">plt2</span><span class="op">)</span>
<span class="va">plt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">plt3</span><span class="op">)</span>

<span class="co"># superimpose the grobs onto an empty ggplot </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt3</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="VignetteA_files/figure-html/unnamed-chunk-15-1.png" alt="**Figure 3a**. Mean glucose level and 95% reference intervals with 95% confidence intervals." width="480"><p class="caption">
<strong>Figure 3a</strong>. Mean glucose level and 95% reference intervals with 95% confidence intervals.
</p>
</div>
</div>
<div id="is-that-it" class="section level2">
<h2 class="hasAnchor">
<a href="#is-that-it" class="anchor"></a>Is that it?</h2>
<p>Well, we are just begining! The whole point of the reference intervals is to provide an indication of the individuals in the population. It would be great if we could see these, don’t you think?</p>
<p>There are multiple ways to illustrate the individuals from a sample. One is using jittered dots: each member of the sample is illustrated with a small dot whose horizontal position can be jittered randomly to avoid that many dots superimposes and no longer be visible.</p>
<p>These is a layout in <code>superb</code> that achieve exacly that, <code>pointjitter</code>. You can for example redo plot 1 but changing the layout, then superimpose the plots again, as in</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># redo plt1; the other 2 are still in memory</span>
<span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, 
            errorbar  <span class="op">=</span> <span class="st">"RI"</span>,
            gamma     <span class="op">=</span> <span class="fl">0.95</span>,
            errorbarParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.0</span>, size <span class="op">=</span> <span class="fl">1.5</span>,
                                  position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">)</span>,
            plotStyle <span class="op">=</span> <span class="st">"pointjitter"</span> <span class="op">)</span> <span class="op">+</span> <span class="va">ornate</span>

<span class="co"># transform the new plot into a visual object</span>
<span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">plt1</span><span class="op">)</span>

<span class="co"># superimpose the grobs onto an empty ggplot </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt3</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="VignetteA_files/figure-html/unnamed-chunk-16-1.png" alt="**Figure 3b**. Jittered dots showing mean glucose level and 95% reference intervals with 95% confidence intervals." width="480"><p class="caption">
<strong>Figure 3b</strong>. Jittered dots showing mean glucose level and 95% reference intervals with 95% confidence intervals.
</p>
</div>
<p>As seen, it is now easy to see the individuals from the sample and that most of them are indeed within the reference intervals.</p>
<p>A more elaborate layout, although maybe redundant with the RI, is the <code>pointjitterviolin</code>. Using it, we get</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># redo plt1; the other 2 are still in memory</span>
<span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, 
            errorbar  <span class="op">=</span> <span class="st">"RI"</span>,
            gamma     <span class="op">=</span> <span class="fl">0.95</span>,
            errorbarParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.0</span>, size <span class="op">=</span> <span class="fl">1.5</span>,
                                  position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">)</span>,
            plotStyle <span class="op">=</span> <span class="st">"pointjitterviolin"</span> <span class="op">)</span> <span class="op">+</span> <span class="va">ornate</span>

<span class="co"># transform the three plots into visual objects</span>
<span class="va">plt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">plt1</span><span class="op">)</span>

<span class="co"># superimpose the grobs onto an empty ggplot </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt3</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="VignetteA_files/figure-html/unnamed-chunk-17-1.png" alt="**Figure 3c**. Jittered dots and violins showing mean glucose level and 95% reference intervals with 95% confidence intervals of the tips' position." width="480"><p class="caption">
<strong>Figure 3c</strong>. Jittered dots and violins showing mean glucose level and 95% reference intervals with 95% confidence intervals of the tips’ position.
</p>
</div>
</div>
<div id="reference-intervals-vs--confidence-intervals-of-the-means" class="section level2">
<h2 class="hasAnchor">
<a href="#reference-intervals-vs--confidence-intervals-of-the-means" class="anchor"></a>Reference intervals vs. confidence intervals of the means</h2>
<p>As one last example, we want to show the difference between the reference intervals and the confidence intervals of a summary statistic, here the mean.</p>
<p>To that end, we can create a fourth plot showing the confidence interval of the means with</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plt4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/superbPlot.html">superbPlot</a></span><span class="op">(</span><span class="va">glucoselevels</span>, 
            BSFactors <span class="op">=</span> <span class="st">"concentration"</span>,  
            variables <span class="op">=</span> <span class="st">"gl"</span>, 
            statistic <span class="op">=</span> <span class="st">"mean"</span>, 
            errorbar  <span class="op">=</span> <span class="st">"CI"</span>,  <span class="co"># just the regular CI of the mean</span>
            errorbarParams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">1.5</span>, color <span class="op">=</span> <span class="st">"blue"</span>,
                                  position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span> <span class="fl">0.00</span><span class="op">)</span> <span class="op">)</span>,
            gamma     <span class="op">=</span> <span class="fl">0.95</span>,
            plotStyle <span class="op">=</span> <span class="st">"line"</span> <span class="op">)</span> <span class="op">+</span> <span class="va">ornate</span> <span class="op">+</span> <span class="fu"><a href="../reference/makeTransparent.html">makeTransparent</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This plot also has transparent theme as it will superimposed on the previous three plots:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># transform that plot too into visual objects</span>
<span class="va">plt4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">plt4</span><span class="op">)</span>

<span class="co"># superimpose the grobs onto an empty ggplot </span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>grob<span class="op">=</span><span class="va">plt4</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="VignetteA_files/figure-html/unnamed-chunk-19-1.png" alt="**Figure 3d**. Jittered dots and violins showing mean glucose level +-95% confidence intervals of the mean, and 95% reference intervals with 95% confidence intervals." width="480"><p class="caption">
<strong>Figure 3d</strong>. Jittered dots and violins showing mean glucose level +-95% confidence intervals of the mean, and 95% reference intervals with 95% confidence intervals.
</p>
</div>
<p>As seen in blue, the confidence interval of the means have much shorter intervals than the reference interval. This is ok (or should I say, <em>normal</em>): Both intervals represent very different things. Also, the interval widths of the CI of the mean are shorter than the interval widths of the CI or the RI tips for two reasons: (1) the RI tips are based on 90% confidence levels; (2) a central tendency statistic is easier to estimate than an extreme quantile statistic.</p>
</div>
<div id="in-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#in-summary" class="anchor"></a>In summary</h2>
<p>Reference intervals are useful to depict the population as a whole. It is not an error bar in the sense that it does not represent the error for the estimation of a statistic. Instead, it is an illustration of the individuals’ possible scores.</p>
<p>Note that Reference intervals <strong>must not</strong> be used in conjunction with adjustments. These adjustments are used when conditions are compared to other conditions. Reference intervals are not comparative statistics, they show the extend of the sample, irrespective of what the other samples might look like.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-f20" class="csl-entry">
Finnegan, D. (2020). <em>referenceIntervals: Reference intervals</em>. Retrieved from <a href="https://CRAN.R-project.org/package=referenceIntervals">https://CRAN.R-project.org/package=referenceIntervals</a>
</div>
<div id="ref-htc14" class="csl-entry">
Harding, B., Tremblay, C., &amp; Cousineau, D. (2014). Standard errors: A review and evaluation of standard error estimators using monte carlo simulations. <em>The Quantitative Methods for Psychology</em>, <em>10</em>(2), 107–123.
</div>
<div id="ref-nccls00" class="csl-entry">
NCCLS. (2000). <em>How to define and determine reference intervals in the clinical laboratory; approved guideline - second edition.</em> (No. NCCLS document C28-A2). 940 West Valley Road, Suite 1400, Wayne, Pennsylvania 19087-1898, USA.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Denis Cousineau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
